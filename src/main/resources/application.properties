# Heimdall - Salesforce Backup Configuration
# All sensitive values should be set via environment variables

# ==============================================================================
# Salesforce Configuration
# ==============================================================================
salesforce.base-url=${SALESFORCE_BASE_URL}
salesforce.grant-type=${SALESFORCE_GRANT_TYPE:client_credentials}
salesforce.client-id=${SALESFORCE_CLIENT_ID}
salesforce.client-secret=${SALESFORCE_CLIENT_SECRET:}
salesforce.api-version=${SALESFORCE_API_VERSION:v61.0}
salesforce.org-id=${SALESFORCE_ORG_ID:}

# JWT authentication (alternative to client_credentials)
# salesforce.grant-type=urn:ietf:params:oauth:grant-type:jwt-bearer
# salesforce.username=${SALESFORCE_USERNAME}
# salesforce.jwt-key-file=${SALESFORCE_JWT_KEY_FILE}
# salesforce.audience-url=${SALESFORCE_AUDIENCE_URL:https://login.salesforce.com}

spring.codec.max-in-memory-size=20MB

# ==============================================================================
# AWS S3 Configuration
# ==============================================================================
aws.s3.bucket-name=${AWS_S3_BUCKET_NAME}
aws.s3.region=${AWS_S3_REGION:eu-north-1}
# Optional: Custom endpoint for S3-compatible storage (MinIO, etc.)
# aws.s3.endpoint=${AWS_S3_ENDPOINT:}

# ==============================================================================
# PostgreSQL Database Configuration
# ==============================================================================
postgres.backup.url=${POSTGRES_URL:jdbc:postgresql://localhost:5432/heimdall}
postgres.backup.username=${POSTGRES_USERNAME:heimdall}
postgres.backup.password=${POSTGRES_PASSWORD}

# ==============================================================================
# Spring Batch Configuration
# ==============================================================================
# Spring Batch uses HSQLDB (in-memory) for job metadata
spring.datasource.url=jdbc:hsqldb:mem:testdb
spring.datasource.driver-class-name=org.hsqldb.jdbc.JDBCDriver
spring.batch.jdbc.initialize-schema=always

# Enable batch job execution (set to false for web-only mode)
spring.batch.job.enabled=true

# Disable web server in batch mode (default)
spring.main.web-application-type=none

# ==============================================================================
# Metadata Auto-Migration
# ==============================================================================
# Automatically create Heimdall_Backup_Config__c object and fields if missing.
# Set false if you deploy metadata manually (e.g. sf project deploy start).
heimdall.metadata.auto-migrate=${HEIMDALL_METADATA_AUTO_MIGRATE:true}

# ==============================================================================
# Backup Settings
# ==============================================================================
# ContentVersion deduplication settings
# Set to 0 to disable size filter (download all files)
# Set to N to skip files smaller than N KB
heimdall.backup.skip-files-below-kb=${HEIMDALL_SKIP_FILES_BELOW_KB:0}

# ==============================================================================
# Logging Configuration
# ==============================================================================
# Debug Salesforce API calls (shows full request URIs including SOQL queries)
#logging.level.org.springframework.web.reactive.function.client.ExchangeFunctions=TRACE
#logging.level.reactor.netty.http.client=DEBUG
#logging.level.se.devrandom.heimdall=DEBUG
#logging.level.se.devrandom.heimdall.web.RestoreService=DEBUG

# ==============================================================================
# API Limit Protection
# ==============================================================================
# Stop backup when org API usage reaches this percentage of daily limit (empty = disabled)
heimdall.api-limit.stop-at-percent=${HEIMDALL_API_LIMIT_STOP_AT_PERCENT:}

# ==============================================================================
# RDS Lifecycle Management
# ==============================================================================
# RDS instance identifier for auto-start/stop (empty = disabled)
rds.instance-identifier=${RDS_INSTANCE_IDENTIFIER:}
